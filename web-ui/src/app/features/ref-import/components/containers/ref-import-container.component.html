<h1>Import into {{ Ref.name }}</h1>

<div class="d-flex" style="gap:20px">
  <input (change)="upload($event)" type='file' class="form-control">
</div>
<hr>

<div class="jumbotron bg-dark text-white" style="background-color:#ffffff !important;">
  <ul>
    <li>
      <mat-checkbox (change)="CheckUpdateExisingEntriesBasedOnBk($event.checked)">
        Mettre à jour les enregistrements sur la base des BK
      </mat-checkbox>
    </li>
    <li>
      <mat-checkbox (change)="CheckDropEntriesWithDuplicateBKs($event.checked)">
        Abandonner les données entrante lors de BK à double
      </mat-checkbox>
    </li>
    <li>
      <mat-checkbox (change)="CheckDropEntriesWithInvalidDateFormats($event.checked)">
        Abandonner les données entrante lors de format de date invalide
      </mat-checkbox>
    </li>
    <li>
      <mat-checkbox (change)="CheckDropEntriesWithMissingRequiredColumns($event.checked)">
        Abandonner les donées entrante de colonnes requises manquantes
      </mat-checkbox>
    </li>
    <li>
      <mat-checkbox (change)="CheckDropEntriesWithInvalidFks($event.checked)">
        Abandonner les données entrante lors de FK non valides
      </mat-checkbox>
    </li>
  </ul>
</div>

<hr>
@if (!isEmpty(EntryErrorMap)) {
  <mat-grid-list cols="2" style="width: 100%;" rowHeight="6em" class="grid-layout-custom">
    <mat-grid-tile colspan="1" [rowspan]="Ref!.columns.length*1.05">
      <div [formGroup]="IncomingEntryForm">
        <h1>Donnée Entrante</h1>
        <ng-container formArrayName="keypairs">
          @for (keyPairFormGroup of IncomingEntryForm.controls.keypairs.controls; track $index) {
            <app-key-value-presentational
              [KeyPairError]="EntryErrorMap[keyPairFormGroup.controls.colId.getRawValue()]"
              [KeyPairFormGroup]="keyPairFormGroup"
              [readOnly]="false">
            </app-key-value-presentational>
          }
        </ng-container>
        <button mat-raised-button color="primary" (click)="emitChoice('takeIncoming')">
          Insérer la mise à jour
        </button>
      </div>
    </mat-grid-tile>
    @if (this.errType == EntryPutErrorTypeEnum.DuplicateBk) {
      <mat-grid-tile colspan="1" [rowspan]="Ref.columns.length * 1.05">
        <div [formGroup]="DestinationEntryForm">
          <h1>Donnée Présente</h1>
          <ng-container formArrayName="keypairs">
            @for (keyPairFormGroup of DestinationEntryForm.controls.keypairs.controls; track $index) {
              <app-key-value-presentational
                [KeyPairError]="EntryErrorMap[keyPairFormGroup.controls.colId.getRawValue()]"
                [KeyPairFormGroup]="keyPairFormGroup"
                [readOnly]="true">
              </app-key-value-presentational>
            }
          </ng-container>
          <button mat-raised-button color="primary" (click)="emitChoice('whatever')">Garder
            l'Enregistrement
          </button>
        </div>
      </mat-grid-tile>
    }
  </mat-grid-list>
}
@if (done) {
  <h2>Done importing all entries.</h2>
}
